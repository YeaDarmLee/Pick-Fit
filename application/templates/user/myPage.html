<!-- header -->
{% include './layout/header.html' %}

<!-- navigation -->
{% include './layout/navigation.html' %}

<!-- myPage -->
<header class="myPage">
  <div class="container card card_temple">
    <h2>MyPage</h2>
    <div class="row">
      <div class="col-6">
        <h4>{{session['user_Nm']}} 님</h4>
        <div class="card card_temple col-8 my-sm-1">
          {% if result.gender == 0 %}
          <p class="text-white">성별 : 남</p>
          {% else %}
          <p class="text-white">성별 : 여</p>
          {% endif %}
          <p class="text-white">나이 : {{result.age}}</p>
          <p class="text-white">키 : {{result.height}}cm</p>
          <p class="text-white">몸무게 : {{result.weight}}kg</p>
          <p class="text-white">체형 : {{result.body_shape}}</p>
          <p class="text-white">취향 : {{result.style}}</p>
          <p class="text-white">피부톤 : {{result.skin_tone}}</p>
          <p class="text-white">얼굴형 : {{result.face_shape}}</p>
          <div class="text-white">헤어스타일 : {{result.hair}}</div>
        </div>
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#secession">탈퇴하기</button>
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modify">부가정보 수정</button>
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#change_pw">비밀번호 변경</button>
      </div>
      <div class="col-6 my-sm-1">
        <div class="card card_temple">
          <h4>검색 기록 List</h4>
          <div class="card card_temple height_500 scroll_bar">
            <div class="card card_temple width_100">
              검색기록 샘플 1
            </div>
            <div class="card card_temple width_100">
              검색기록 샘플 2
            </div>
            <div class="card card_temple width_100">
              검색기록 샘플 3
            </div>
            <div class="card card_temple width_100">
              검색기록 샘플 4
            </div>
            <div class="card card_temple width_100">
              검색기록 샘플 5
            </div>
            <div class="card card_temple width_100">
              검색기록 샘플 6
            </div>
            <div class="card card_temple width_100">
              검색기록 샘플 7
            </div>
            <div class="card card_temple width_100">
              검색기록 샘플 8
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Modal (비밀번호 변경) -->
<div class="modal fade" id="change_pw" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-muted" id="exampleModalLabel">비밀번호 변경</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <form class="text-align-center" id="change_pw_form">
          <!-- current_pw input -->
          <div class="form-floating mb-3 ">
            <input class="form-control input-sm" id="current_pw" name="current_pw" type="password" required />
            <label for="current_pw">현재 비밀번호</label>
          </div>
          <!-- new_pw input -->
          <div class="form-floating mb-3 ">
            <input class="form-control input-sm" id="new_pw" name="new_pw" type="password" required />
            <label for="new_pw">새 비밀번호</label>
          </div>
          <!-- newCheck_pw input -->
          <div class="form-floating mb-3 ">
            <input class="form-control input-sm" id="newCheck_pw" name="newCheck_pw" type="password" required />
            <label for="newCheck_pw">새 비밀번호 확인</label>
          </div>
        </form>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" id="tampleBtn" class="btn btn-warning" onclick="change_pw()">Save changes</button>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- Modal (수정하기) -->
{% include './user/components/modify.html' %}

<!-- Modal (회원탈퇴) -->
<div class="modal fade" id="secession" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-muted" id="exampleModalLabel">회원탈퇴</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <p class="item-intro text-muted">정말 탈퇴하시겠습니까?</p>
        <p class="item-intro text-muted">탈퇴하실 경우, 현재 등록된 모든 정보가 삭제됩니다.</p>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
          <button type="button" id="tampleBtn" class="btn btn-warning" onclick="secession()">Yes</button>
        </div>

      </div>
    </div>
  </div>
</div>

<script>
  // 로그인 안할 경우 alert 오픈
  if ("{{session['login']}}" == '' || "{{session['login']}}" == false) {
    $(document).ready(function () {
      alertStart('error', 'MyPage', '로그인 후 이용 가능합니다.', 'replace', '/index')
    });
  }

  function change_pw() {
    var form = $('#change_pw_form')[0];
    var data = new FormData(form);

    $.ajax({
      type: "POST",
      enctype: 'multipart/form-data',
      url: '/user/change_pw',
      data: data,
      processData: false,
      contentType: false,
      cache: false,
      timeout: 600000,
      success: function (data) {
        if (data.code === 20000) {
          alertStart('success', 'Change Password', data.result, 'replace', '/myPage', 500)
        } else {
          alertStart('error', 'Change Password', data.result)
        }
      },
      error: function (e) {
        alertStart('error', 'Change Password', '비밀번호 변경중 오류가 발생하였습니다.')
      }
    });
  }

  function modify() {
    var form = $('#modify_form')[0];
    var data = new FormData(form);

    $.ajax({
      type: "POST",
      enctype: 'multipart/form-data',
      url: '/user/modify',
      data: data,
      processData: false,
      contentType: false,
      cache: false,
      timeout: 600000,
      success: function (data) {
        if (data.code === 20000) {
          alertStart('success', 'Change Modify', data.result, 'replace', '/myPage', 500)
        } else {
          alertStart('error', 'Change Modify', data.result)
        }
      },
      error: function (e) {
        alertStart('error', 'Change Modify', '추가정보 업데이트중 오류가 발생하였습니다.')
      }
    });
  }

  function secession() {
    $.ajax({
      type: "POST",
      url: '/user/secession',
      processData: false,
      contentType: false,
      cache: false,
      timeout: 600000,
      success: function (data) {
        if (data.code === 20000) {
          alertStart('success', '회원탈퇴', data.result, 'replace', '/', 500)
        } else {
          alertStart('error', '회원탈퇴', data.result)
        }
      },
      error: function (e) {
        alertStart('error', '회원탈퇴', '회원탈퇴중 오류가 발생하였습니다.')
      }
    });
  }
</script>

<style>
  .width_100 {
    width: 100%;
  }
  .height_500 {
    height: 467px;
    margin: 0;
    padding: 0;
  }
  .margin_1rem {
    margin: 1rem;
  }
  .padding_top_0{
    padding-top: 0px;
  }

</style>
<!-- Footer-->
{% include './layout/footer.html' %}