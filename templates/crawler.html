{% include './layout/header.html' %}
<script>
  var input_num = 0;
  const add_textbox = () => {
    const box = document.getElementById("tag_input");
    const newP = document.createElement('spen');
    newP.innerHTML =  '<div class="card mb-3 col-4 disply_ini">' +
                      '<div class="form-floating">' +
                      '<input class="form-control" id="tag' + input_num +'" name="tag' + input_num +'" type="text"/>' +
                      '<label for="tag' + input_num +'">Search tag</label>' +
                      '</div>' +
                      '<div class="form-floating">' +
                      '<input class="form-control" id="name' + input_num +'" name="name' + input_num +'" type="text"/>' +
                      '<label for="name' + input_num +'">Class Name</label>' +
                      '</div>' +
                      '</div>'
    box.appendChild(newP);
    input_num ++
  }

  var add_m_input_num = 0;
  const add_m_input = () => {
    if (add_m_input_num < 6) {
      const box = document.getElementById("addTample_input");
      const newP = document.createElement('spen');
      newP.innerHTML =  '<div class="card mb-3 col-6 disply_ini">' +
                        '<div class="form-floating">' +
                        '<input class="form-control" id="tampleTag' + add_m_input_num +'" name="tampleTag' + add_m_input_num +'" type="text"/>' +
                        '<label for="tampleTag' + add_m_input_num +'">Search tag</label>' +
                        '</div>' +
                        '<div class="form-floating">' +
                        '<input class="form-control" id="tampleClass' + add_m_input_num +'" name="tampleClass' + add_m_input_num +'" type="text"/>' +
                        '<label for="tampleClass' + add_m_input_num +'">Class Name</label>' +
                        '</div>' +
                        '</div>'
      box.appendChild(newP);
      add_m_input_num ++
    } else {
      alert ('input은 최대 6개까지 생성할 수 있습니다.')
    }
  }
</script>
<header class="page-section" id="contact">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-xl-6 text-center">
                <h1 class="mt-0 text-white font-weight-bold">크롤링 Page</h1>
                <hr class="divider" />
                <p class="text-white-75" style="margin: 1.5rem auto;">이 페이지에서는 크롤링한 Text 확인가능함</p>
            </div>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-6">
            <form id="contactForm" action="/crawler" method="POST">
              <!-- Submit Button-->
              <div class="col-12 mb-3">
                <input class="btn btn-primary col-auto" id="submitButton" value="크롤링 시작" type="submit"/>
                <input class="btn btn-primary col-auto" type="button" value="태그 추가" onclick="add_textbox()"/>
                <!-- Button trigger modal -->
                <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#addTample">
                  양식 추가
                </button>
                <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#searchTample">
                  양식 조회
                </button>
                <a class="btn btn-secondary float-end" href="/">처음으로</a>
              </div>
              <!-- url input-->
              <div class="form-floating mb-3">
                <input class="form-control" id="url" name="url" type="text" required/>
                <label for="url">Search url</label>
              </div>
              <!-- tag input-->
              <div id="tag_input">
              </div>
            </form>
        </div>
    </div>

    <div class="container px-4 px-lg-5" style="margin-top: 30px;">
      <div class="row gx-4 gx-lg-5 justify-content-center">
        <div class="col-lg-8 col-xl-6 text-center">
          {% if result.code == 20000 %}
            <div class="text-center card" style="margin:0 auto;">
              <table class="table table-hover text-black-50">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Result</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th>url</th>
                    <td>{{result.url}}</td>
                  </tr>
                  <tr>
                    <th>tag</th>
                    <td>
                      {{result.tag}}
                    </td>
                  </tr>
                  <tr>
                    <th>class</th>
                    <td>
                      {{result.classNm}}
                    </td>
                  </tr>
                  {% for result_txt in result.result_txt %}
                  <tr>
                    <th>txt</th>
                    <td>
                      {{result_txt}}
                    </td>
                  </tr>
                  {% endfor %}
                  <tr>
                    <th>Image</th>
                    <td>
                      {% for img in result.result_img %}
                        <img src="{{img}}" style="width: 30%;">
                      {% endfor %}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          {% elif result.code == 40000 %}
            <p class="text-muted" style="margin-bottom: 10px;">크롤링에 실패하였습니다.</p>
            <p class="text-muted" style="margin-bottom: 10px;">검색한 Url이나 HTML 태그가 존재 하는지 확인해주세요.</p>
          {% endif %}
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="addTample" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title text-muted" id="exampleModalLabel">크롤링 양식 추가</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="text-muted">
            여기에 설정한 값을 DB에 저장합니다.
          </p>
          
          <form id="tampleForm">
            <!-- url input-->
            <div class="form-floating mb-3">
              <input class="form-control" id="tampleName" name="tampleName" type="text" required/>
              <label for="tampleName">Name</label>
            </div>
            <!-- url input-->
            <div class="form-floating mb-3">
              <input class="form-control" id="tampleUrl" name="tampleUrl" type="text" required/>
              <label for="tampleUrl">Search url</label>
            </div>

            <div id="addTample_input">
            </div>
          </form>

          
          <div class="modal-footer">
            <input class="btn btn-primary col-auto" type="button" value="태그 추가" onclick="add_m_input()"/>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" id="tampleBtn" class="btn btn-warning">Save changes</button>
          </div>

        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="searchTample" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title text-muted" id="exampleModalLabel">크롤링 양식 조회</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="text-muted">
            저장한 값을 불러옵니다
          </p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

</header>

<script>
  $('#tampleBtn').click(function(){
    var form = $('#tampleForm')[0];
		var data = new FormData(form);

    $.ajax({
      type: 'POST',
      enctype: 'multipart/form-data',
      url: '/addTemplate',
      data: data ,
			processData: false,
			contentType: false,
			cache: false,
			timeout: 600000,
        success: function(data){
          if (data.code == 20000){
            alert('ajax 전송 성공')
            // location reload 하던지 form 값 초기화 시켜주는 로직 필요
            location.reload()
          } else {
            alert('ajax 전송 실패')
          }
        },
        error: function(request, status, error){
          alert('ajax 전송 실패')
        }
      })
  })
</script>
{% include './layout/footer.html' %}